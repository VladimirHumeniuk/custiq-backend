generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String   @id @default(uuid())
  clerkUserId  String   @unique
  email        String   @unique
  firstName    String?
  lastName     String?
  companyName  String?
  shortAbout   String?
  blockedTopics String[]
  interviewLanguage String @default("English")
  primaryCustomerType String?
  settingsConfigured Boolean @default(false)
  researches   Research[]
  interviews   Interview[]
  interviewSessions InterviewSession[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Research {
  id              String      @id @default(uuid())
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  researchName    String
  researchAbout   String?
  primaryGoal     String
  audiences       String[]
  focusAreas      String[]
  deepDive        String?
  competitors     String?
  topicsToAvoid   String?
  interviews      Interview[]
  interviewSessions InterviewSession[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model Interview {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  researchId      String?
  research        Research? @relation(fields: [researchId], references: [id], onDelete: SetNull)
  interviewSlug   String    @unique
  interviewUrl    String
  title           String
  publicTitle     String
  interviewLength String
  interviewTone   String
  active          Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  sessions        InterviewSession[]
}

model InterviewSession {
  id                    String    @id @default(uuid())
  researchId            String
  research              Research   @relation(fields: [researchId], references: [id], onDelete: Cascade)
  interviewId           String
  interview             Interview  @relation(fields: [interviewId], references: [id], onDelete: Cascade)
  createdBy             String
  createdByUser         User       @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  status                String     @default("active")
  startedAt             DateTime   @default(now())
  endedAt               DateTime?
  mode                  String
  participantName       String
  sessionToken          String     @unique
  promptVersionId       String     @default("interviewer_v1")
  personaId             String     @default("professional")
  compiledPromptHash    String?
  globalContextSnapshot Json?
  researchContextSnapshot Json?
  lastActivityAt        DateTime   @default(now())
  completed             Boolean   @default(false)
  segments              TranscriptSegment[]
  report                InterviewReport?
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt
}

model TranscriptSegment {
  id                String   @id @default(uuid())
  interviewSessionId String
  session            InterviewSession @relation(fields: [interviewSessionId], references: [id], onDelete: Cascade)
  role               String
  text               String
  tsStart            Float?
  tsEnd              Float?
  metaJson           Json?
  createdAt          DateTime @default(now())
}

model InterviewReport {
  id                  String   @id @default(uuid())
  interviewSessionId  String   @unique
  session             InterviewSession @relation(fields: [interviewSessionId], references: [id], onDelete: Cascade)
  summary             String
  keyQuotesJson       Json
  painsJson           Json
  opportunitiesJson   Json
  interviewCompleted  Boolean  @default(true)
  createdAt           DateTime @default(now())
}

